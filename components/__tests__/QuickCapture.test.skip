import React from 'react';
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import QuickCapture from '../QuickCapture';

// Mock taskService
jest.mock('../../services/taskService', () => ({
  taskService: {
    createTask: jest.fn(),
  },
}));

describe('QuickCapture', () => {
  const mockOnTaskCreated = jest.fn();

  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('should render the component', () => {
    render(<QuickCapture onTaskCreated={mockOnTaskCreated} />);

    expect(screen.getByPlaceholderText('What needs to be done?')).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /add task/i })).toBeInTheDocument();
  });

  it('should disable submit button when title is empty', () => {
    render(<QuickCapture onTaskCreated={mockOnTaskCreated} />);

    const submitButton = screen.getByRole('button', { name: /add task/i });
    expect(submitButton).toBeDisabled();
  });

  it('should enable submit button when title has text', async () => {
    const user = userEvent.setup();
    render(<QuickCapture onTaskCreated={mockOnTaskCreated} />);

    const titleInput = screen.getByPlaceholderText('What needs to be done?');
    await user.type(titleInput, 'Test Task');

    const submitButton = screen.getByRole('button', { name: /add task/i });
    expect(submitButton).not.toBeDisabled();
  });

  it('should show character count', () => {
    render(<QuickCapture onTaskCreated={mockOnTaskCreated} />);

    expect(screen.getByText(/200 characters remaining/i)).toBeInTheDocument();
  });
});
